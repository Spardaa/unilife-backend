# iOS App ä¸åç«¯è”é€šæŒ‡å—

## æ¨èçš„å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 1: æœ¬åœ°è”é€šï¼ˆå¿…é¡»å…ˆåšï¼‰                         â”‚
â”‚  æ—¶é—´ï¼š1-2 å°æ—¶                                      â”‚
â”‚  ç›®çš„ï¼šç¡®ä¿åŠŸèƒ½æ­£å¸¸ï¼Œæ— åŸºç¡€é—®é¢˜                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é˜¶æ®µ 2: éƒ¨ç½²åç«¯åˆ°äº‘ç«¯                              â”‚
â”‚  æ—¶é—´ï¼š2-3 å°æ—¶                                      â”‚
â”‚  ç›®çš„ï¼šè®© iOS App èƒ½ä»å¤–ç½‘è®¿é—®                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é˜¶æ®µ 3: åˆ‡æ¢ iOS é…ç½®åˆ°äº‘ç«¯                         â”‚
â”‚  æ—¶é—´ï¼š5 åˆ†é’Ÿ                                        â”‚
â”‚  ç›®çš„ï¼šiOS è®¿é—®äº‘ç«¯åç«¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é˜¶æ®µ 4: çœŸæœºæµ‹è¯•                                    â”‚
â”‚  æ—¶é—´ï¼š30 åˆ†é’Ÿ                                       â”‚
â”‚  ç›®çš„ï¼šç¡®ä¿çœŸå®ç¯å¢ƒæ­£å¸¸å·¥ä½œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é˜¶æ®µ 1: æœ¬åœ°è”é€šï¼ˆç°åœ¨åšï¼‰

### ä¸ºä»€ä¹ˆè¦å…ˆæœ¬åœ°è”é€šï¼Ÿ

```
âŒ ä¸æ¨èçš„ç›´æ¥éƒ¨ç½²ï¼š
1. éƒ¨ç½²åˆ°äº‘ç«¯ â†’ å‘ç° API è®¾è®¡æœ‰é—®é¢˜ â†’ ä¿®æ”¹ â†’ é‡æ–°éƒ¨ç½²
2. éƒ¨ç½²åˆ°äº‘ç«¯ â†’ å‘ç°æ•°æ®åº“å­—æ®µä¸å¯¹ â†’ ä¿®æ”¹ â†’ é‡æ–°éƒ¨ç½²
3. éƒ¨ç½²åˆ°äº‘ç«¯ â†’ è°ƒè¯•ä¸æ–¹ä¾¿ï¼ˆæ¯æ¬¡ä¿®æ”¹éƒ½è¦ä¸Šä¼ ï¼‰
4. æµªè´¹æ—¶é—´ï¼Œæµªè´¹äº‘æœåŠ¡å™¨è´¹ç”¨

âœ… æ¨èçš„æœ¬åœ°è”é€šï¼š
1. æœ¬åœ°è¿è¡Œåç«¯
2. iOS æ¨¡æ‹Ÿå™¨è¿æ¥æœ¬åœ°åç«¯
3. è°ƒé€šæ‰€æœ‰æ¥å£
4. ä¿®å¤æ‰€æœ‰é—®é¢˜
5. ç¡®è®¤æ— è¯¯åéƒ¨ç½²åˆ°äº‘ç«¯
```

### å…·ä½“æ­¥éª¤

#### 1.1 å¯åŠ¨æœ¬åœ°åç«¯

```bash
# åœ¨åç«¯é¡¹ç›®ç›®å½•
cd /Users/natsu/Desktop/unilife/unilife-backend

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python -m app.main

# æˆ–ä½¿ç”¨ uvicornï¼ˆæ”¯æŒçƒ­é‡è½½ï¼‰
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

#### 1.2 ç¡®è®¤åç«¯æ­£å¸¸è¿è¡Œ

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
curl http://localhost:8000/health

# åº”è¯¥è¿”å›ï¼š
# {"status": "healthy"}

# æµ‹è¯•èŠå¤©æ¥å£
curl -X POST http://localhost:8000/api/v1/chat \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "test_user_001",
    "message": "ä½ å¥½"
  }'
```

#### 1.3 é…ç½® iOS App è¿æ¥æœ¬åœ°åç«¯

```swift
// Config.swift - å¼€å‘ç¯å¢ƒé…ç½®
struct APIConfig {
    #if DEBUG
    // å¼€å‘ç¯å¢ƒï¼šè¿æ¥æœ¬åœ°åç«¯
    static let baseURL = "http://localhost:8000"
    #else
    // ç”Ÿäº§ç¯å¢ƒï¼šè¿æ¥äº‘ç«¯åç«¯ï¼ˆç¨åé…ç½®ï¼‰
    static let baseURL = "https://your-backend-domain.com"
    #endif

    static let timeout: TimeInterval = 30.0
}

// APIService.swift
class APIService {
    static let shared = APIService()

    private let baseURL: String
    private let session: URLSession

    init() {
        self.baseURL = APIConfig.baseURL

        let config = URLSessionConfiguration.default
        config.timeoutIntervalForRequest = APIConfig.timeout
        self.session = URLSession(configuration: config)
    }

    func chat(userId: String, message: String) async throws -> ChatResponse {
        let url = URL(string: "\(baseURL)/api/v1/chat")!
        var request = URLRequest(url: url)
        request.httpMethod = "POST"
        request.setValue("application/json", forHTTPHeaderField: "Content-Type")

        let body: [String: Any] = [
            "user_id": userId,
            "message": message
        ]
        request.httpBody = try? JSONSerialization.data(withJSONObject: body)

        let (data, response) = try await session.data(for: request)

        guard let httpResponse = response as? HTTPURLResponse,
              httpResponse.statusCode == 200 else {
            throw APIError.requestFailed
        }

        let chatResponse = try JSONDecoder().decode(ChatResponse.self, from: data)
        return chatResponse
    }
}

// Models.swift
struct ChatResponse: Codable {
    let reply: String
    let user_id: String
    let message_id: String
    // æ ¹æ®å®é™…è¿”å›ç»“æ„è°ƒæ•´
}
```

#### 1.4 åœ¨ iOS æ¨¡æ‹Ÿå™¨æµ‹è¯•

```swift
// ContentView.swift æˆ–æŸä¸ªæµ‹è¯•ç•Œé¢
struct TestView: View {
    @State private var messages: [String] = []

    var body: some View {
        VStack {
            List(messages, id: \.self) { msg in
                Text(msg)
            }

            Button("æµ‹è¯•åç«¯è¿æ¥") {
                Task {
                    do {
                        let response = try await APIService.shared.chat(
                            userId: "test_ios_user",
                            message: "ä½ å¥½ï¼Œè¿™æ˜¯æ¥è‡ª iOS çš„æ¶ˆæ¯"
                        )
                        messages.append("AI: \(response.reply)")
                    } catch {
                        messages.append("é”™è¯¯: \(error.localizedDescription)")
                    }
                }
            }
        }
    }
}
```

#### 1.5 æœ¬åœ°è°ƒè¯•æŠ€å·§

```bash
# åç«¯æŸ¥çœ‹æ—¥å¿—
# ä¿®æ”¹ app/main.pyï¼Œæ·»åŠ è¯·æ±‚æ—¥å¿—ï¼š
@app.middleware("http")
async def log_requests(request: Request, call_next):
    print(f"ğŸ“¥ {request.method} {request.url.path}")
    print(f"ğŸ“‹ Headers: {dict(request.headers)}")

    response = await call_next(request)

    print(f"ğŸ“¤ Status: {response.status_code}")
    return response
```

#### 1.6 å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| è¿æ¥æ‹’ç» | åç«¯æ²¡å¯åŠ¨ | `python -m app.main` |
| è¶…æ—¶ | é˜²ç«å¢™/ç«¯å£å ç”¨ | æ£€æŸ¥ 8000 ç«¯å£æ˜¯å¦è¢«å ç”¨ |
| 404 é”™è¯¯ | è·¯å¾„é”™è¯¯ | ç¡®è®¤æ˜¯ `/api/v1/chat` ä¸æ˜¯ `/chat` |
| CORS é”™è¯¯ | æµè§ˆå™¨é™åˆ¶ | iOS ä¸å— CORS é™åˆ¶ï¼Œå¯å¿½ç•¥ |

---

## é˜¶æ®µ 2: éƒ¨ç½²åç«¯åˆ°äº‘ç«¯ï¼ˆæœ¬åœ°è”é€šåï¼‰

### 2.1 é€‰æ‹©äº‘æœåŠ¡å™¨

```
æ¨èé…ç½®ï¼š
- è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨
- 2æ ¸4GB
- æŒ‰é‡ä»˜è´¹ï¼ˆçº¦ Â¥0.08/å°æ—¶ï¼‰
- ç³»ç»Ÿï¼šUbuntu 22.04

è´¹ç”¨ï¼šé¦–æ¬¡è´­ä¹°é€šå¸¸æœ‰ä¼˜æƒ ï¼ˆÂ¥50-100/å¹´ï¼‰
```

### 2.2 ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæˆ‘å¯ä»¥å¸®ä½ å‡†å¤‡ï¼‰

```bash
# deploy.sh - è‡ªåŠ¨éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨
#!/bin/bash

# ä½¿ç”¨æ–¹æ³•ï¼š
# ./deploy.sh root@your-server-ip

SERVER=$1

echo "å¼€å§‹éƒ¨ç½²åˆ° $SERVER ..."

# ä¸Šä¼ ä»£ç 
rsync -avz --exclude='__pycache__' \
  --exclude='*.pyc' \
  --exclude='.git' \
  . $SERVER:/opt/unilife-backend/

# å®‰è£…ä¾èµ–
ssh $SERVER "cd /opt/unilife-backend && pip3 install -r requirements.txt"

# å¯åŠ¨æœåŠ¡
ssh $SERVER "cd /opt/unilife-backend && ./start.sh"

echo "éƒ¨ç½²å®Œæˆï¼"
```

### 2.3 é…ç½® Nginx åå‘ä»£ç†

```nginx
# /etc/nginx/sites-available/unilife
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 2.4 é…ç½® HTTPSï¼ˆå…è´¹ï¼‰

```bash
# å®‰è£… certbot
sudo apt install certbot python3-certbot-nginx

# è‡ªåŠ¨é…ç½® HTTPS
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## é˜¶æ®µ 3: åˆ‡æ¢ iOS é…ç½®åˆ°äº‘ç«¯

### 3.1 æ›´æ–° iOS é…ç½®

```swift
// Config.swift
struct APIConfig {
    #if DEBUG
    // å¦‚æœæƒ³åœ¨è°ƒè¯•ç¯å¢ƒä¹Ÿç”¨äº‘ç«¯ï¼š
    static let baseURL = "https://your-backend-domain.com"

    // æˆ–ä¿æŒæœ¬åœ°ï¼š
    // static let baseURL = "http://localhost:8000"
    #else
    // ç”Ÿäº§ç¯å¢ƒï¼šäº‘ç«¯
    static let baseURL = "https://your-backend-domain.com"
    #endif
}
```

### 3.2 æ·»åŠ ç¯å¢ƒåˆ‡æ¢å¼€å…³ï¼ˆå¯é€‰ï¼‰

```swift
// SettingsView.swift - è®©ç”¨æˆ·å¯ä»¥é€‰æ‹©ç¯å¢ƒ
struct SettingsView: View {
    @AppStorage("apiEnvironment") private var environment: String = "production"

    var body: some View {
        Form {
            Picker("API ç¯å¢ƒ", selection: $environment) {
                Text("äº‘ç«¯").tag("production")
                Text("æœ¬åœ°").tag("development")
            }
        }
    }
}

// APIService.swift
class APIService {
    static let shared = APIService()

    private var baseURL: String {
        let env = UserDefaults.standard.string(forKey: "apiEnvironment") ?? "production"
        return env == "development" ? "http://localhost:8000" : "https://your-backend-domain.com"
    }

    // ...
}
```

---

## é˜¶æ®µ 4: çœŸæœºæµ‹è¯•

### 4.1 æ³¨æ„äº‹é¡¹

```
âš ï¸ çœŸæœºæ— æ³•è®¿é—® localhost
- iOS çœŸæœºä¸Šçš„ localhost æ˜¯æ‰‹æœºæœ¬èº«ï¼Œä¸æ˜¯ Mac
- éœ€è¦è®©çœŸæœºå’Œ Mac åœ¨åŒä¸€ WiFi
- ä½¿ç”¨ Mac çš„ IP åœ°å€ï¼ˆå¦‚ 192.168.1.100ï¼‰
```

### 4.2 çœŸæœºè¿æ¥æœ¬åœ°åç«¯ï¼ˆè°ƒè¯•ç”¨ï¼‰

```swift
// Config.swift
struct APIConfig {
    #if targetEnvironment(simulator)
    // æ¨¡æ‹Ÿå™¨ï¼šä½¿ç”¨ localhost
    static let baseURL = "http://localhost:8000"
    #else
    // çœŸæœºï¼šä½¿ç”¨ Mac çš„ IPï¼ˆç¡®ä¿åœ¨åŒä¸€ WiFiï¼‰
    // å…ˆåœ¨ Mac ä¸Šè¿è¡Œï¼šifconfig | grep inet
    static let baseURL = "http://192.168.1.100:8000"
    #endif
}
```

### 4.3 çœŸæœºè¿æ¥äº‘ç«¯åç«¯

```swift
// ç›´æ¥é…ç½®äº‘ç«¯åœ°å€
struct APIConfig {
    static let baseURL = "https://your-backend-domain.com"
}
```

---

## å®Œæ•´æ—¶é—´çº¿

```
Day 1 - æœ¬åœ°å¼€å‘ä¸è”é€š
  â”œâ”€ 1 å°æ—¶ï¼šå¯åŠ¨åç«¯ï¼Œæµ‹è¯• API
  â”œâ”€ 1 å°æ—¶ï¼šiOS é›†æˆ API
  â””â”€ 1 å°æ—¶ï¼šæœ¬åœ°è°ƒè¯•ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸

Day 2 - éƒ¨ç½²åç«¯ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥å‡ å¤©åå†åšï¼‰
  â”œâ”€ 30 åˆ†é’Ÿï¼šè´­ä¹°äº‘æœåŠ¡å™¨
  â”œâ”€ 1 å°æ—¶ï¼šéƒ¨ç½²åç«¯ä»£ç 
  â”œâ”€ 30 åˆ†é’Ÿï¼šé…ç½®åŸŸåå’Œ HTTPS
  â””â”€ 30 åˆ†é’Ÿï¼šiOS åˆ‡æ¢åˆ°äº‘ç«¯ï¼Œæµ‹è¯•

æ€»è®¡ï¼šçº¦ 4-6 å°æ—¶ï¼ˆåˆ†ä¸¤å¤©å®Œæˆæ›´å¥½ï¼‰
```

---

## å¸¸è§é—®é¢˜

### Q1: æœ¬åœ°æµ‹è¯•æ—¶ï¼ŒiOS æ¨¡æ‹Ÿå™¨è¿ä¸ä¸Šåç«¯ï¼Ÿ

```bash
# æ£€æŸ¥åç«¯æ˜¯å¦åœ¨ç›‘å¬æ‰€æœ‰æ¥å£ï¼ˆä¸åªæ˜¯ 127.0.0.1ï¼‰
# ä¿®æ”¹å¯åŠ¨å‘½ä»¤ï¼š
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Q2: éƒ¨ç½²åˆ°äº‘ç«¯åï¼ŒiOS è¿ä¸ä¸Šï¼Ÿ

```bash
# æ£€æŸ¥æ¸…å•ï¼š
1. äº‘æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 80/443 ç«¯å£
2. åç«¯æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œ
3. Nginx é…ç½®æ˜¯å¦æ­£ç¡®
4. åŸŸå DNS æ˜¯å¦è§£ææ­£ç¡®
5. HTTPS è¯ä¹¦æ˜¯å¦æœ‰æ•ˆ
```

### Q3: å¦‚ä½•åœ¨å¼€å‘ç¯å¢ƒå¿«é€Ÿåˆ‡æ¢æœ¬åœ°/äº‘ç«¯ï¼Ÿ

```swift
// ä½¿ç”¨ç¼–è¯‘æ¡ä»¶ + è¿è¡Œæ—¶å¼€å…³
struct APIConfig {
    // å¼€å‘æ—¶å¯ä»¥åœ¨ App å†…åˆ‡æ¢ï¼Œå‘å¸ƒåå›ºå®šäº‘ç«¯
    @AppStorage("useLocalBackend") private var useLocal: Bool = false

    static var baseURL: String {
        if useLocal {
            return "http://192.168.1.100:8000" // ä½ çš„ Mac IP
        } else {
            return "https://your-backend-domain.com"
        }
    }
}
```

---

## æ€»ç»“

### æ¨èé¡ºåº

```
âœ… 1. æœ¬åœ°è”é€šï¼ˆå¿…é¡»å…ˆåšï¼‰
   - ç¡®ä¿åŠŸèƒ½æ­£å¸¸
   - èŠ‚çœè°ƒè¯•æ—¶é—´
   - é¿å…åå¤éƒ¨ç½²

âœ… 2. æœ¬åœ°æµ‹è¯•å……åˆ†
   - å„ç§åœºæ™¯æµ‹è¯•
   - è¾¹ç•Œæƒ…å†µéªŒè¯
   - ä¿®å¤æ‰€æœ‰ bug

âœ… 3. éƒ¨ç½²åˆ°äº‘ç«¯
   - ä¸€é”®éƒ¨ç½²è„šæœ¬
   - é…ç½® HTTPS
   - ç”Ÿäº§ç¯å¢ƒæµ‹è¯•

âœ… 4. å‘å¸ƒ App
   - æäº¤ App Store
   - ç­‰å¾…å®¡æ ¸
   - æ­£å¼ä¸Šçº¿
```

### å…³é”®æé†’

```
ä¸è¦è·³è¿‡æœ¬åœ°è”é€šæ­¥éª¤ï¼

åŸå› ï¼š
1. äº‘ç«¯è°ƒè¯•æ¯”æœ¬åœ°æ…¢ 10 å€
2. æ¯æ¬¡ä¿®æ”¹éƒ½è¦ä¸Šä¼ ä»£ç 
3. æ— æ³•ä½¿ç”¨æ–­ç‚¹è°ƒè¯•
4. æµªè´¹äº‘æœåŠ¡å™¨è´¹ç”¨

å…ˆæœ¬åœ°åšå¥½ï¼Œå†éƒ¨ç½²äº‘ç«¯ã€‚
```
