# åŒå±‚æ—¶é—´æ¶æ„å®æ–½æ€»ç»“

## ğŸ“‹ æ–¹æ¡ˆæ¦‚è¿°

å®ç°äº†"å¯¹å¤–æŸ”æ€§ï¼Œå¯¹å†…åˆšæ€§"çš„åŒå±‚æ—¶é—´æ¶æ„ï¼š

- **å±•ç¤ºå±‚ï¼ˆæŸ”æ€§ï¼‰**ï¼š`10ç‚¹å¼€ä¼šï¼ˆçº¦1å°æ—¶ï¼‰` - äººæ€§åŒ–ï¼Œå‡å°‘ç„¦è™‘
- **æ•°æ®å±‚ï¼ˆåˆšæ€§ï¼‰**ï¼šå­˜å‚¨ `start_time`, `end_time`, `duration` - æ”¯æŒç®—æ³•è®¡ç®—
- **ç®—æ³•å±‚ï¼ˆåˆšæ€§ï¼‰**ï¼šå†²çªæ£€æµ‹ã€ç²¾åŠ›è¯„ä¼°ç­‰ä½¿ç”¨ç¡®å®šçš„æ—¶é—´æ•°æ®

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ•°æ®æ¨¡å‹æ‰©å±•
**æ–‡ä»¶**ï¼š`app/models/event.py`

æ–°å¢å­—æ®µï¼š
```python
duration_source: Literal["user_exact", "ai_estimate", "default", "user_adjusted"]
duration_confidence: float  # 0.0-1.0ï¼Œé˜ˆå€¼ 0.7
duration_actual: Optional[int]
ai_original_estimate: Optional[int]
display_mode: Literal["flexible", "rigid"]
```

### 2. AI ä¼°æ—¶ Agent
**æ–‡ä»¶**ï¼š`app/agents/duration_estimator.py`

åŠŸèƒ½ï¼š
- åŸºäºå†å²æ•°æ®ä¼°è®¡æ—¶é•¿
- é»˜è®¤å€¼åŒ¹é…ï¼ˆä¼šè®®60åˆ†é’Ÿã€å¥èº«90åˆ†é’Ÿç­‰ï¼‰
- LLM æ™ºèƒ½ä¼°è®¡ï¼ˆå¯é€‰ï¼‰
- ä»å®Œæˆä¸­å­¦ä¹ 

### 3. æ—¶é—´æ ¼å¼åŒ–å·¥å…·
**æ–‡ä»¶**ï¼š`app/utils/time_formatter.py`

åŠŸèƒ½ï¼š
- æŸ”æ€§æ˜¾ç¤ºï¼š`10:00 å¼€ä¼šï¼ˆçº¦1å°æ—¶ï¼‰`
- åˆšæ€§æ˜¾ç¤ºï¼š`10:00-11:00 å¼€ä¼š`
- æ™ºèƒ½åˆ¤æ–­æ˜¯å¦æ˜¾ç¤º"AIä¼°è®¡"æ ‡æ³¨ï¼ˆç½®ä¿¡åº¦ < 0.7ï¼‰

### 4. å·¥å…·é›†æˆ
**æ–‡ä»¶**ï¼š`app/agents/tools.py`

æ›´æ–°å·¥å…·ï¼š
- `tool_create_event`ï¼šé›†æˆ AI ä¼°æ—¶
- `tool_complete_event`ï¼šè®°å½•å®é™…æ—¶é•¿å¹¶å­¦ä¹ 
- `tool_check_time_conflicts`ï¼šæŸ”æ€§å†²çªæç¤º

### 5. å‰ç«¯é€‚é…
**æ–‡ä»¶**ï¼š`client.py`

æ›´æ–°ï¼š
- `format_events_display`ï¼šä½¿ç”¨æŸ”æ€§æ—¶é—´æ˜¾ç¤º
- è‡ªåŠ¨æ ¹æ® `duration_source` å’Œ `duration_confidence` æ ¼å¼åŒ–

### 6. æµ‹è¯•æ–‡ä»¶
**æ–‡ä»¶**ï¼š`test_dual_time_architecture.py`

æµ‹è¯•è¦†ç›–ï¼š
- AI ä¼°æ—¶åŠŸèƒ½
- æ—¶é—´æ ¼å¼åŒ–
- ä¸åŒæ—¶é•¿æ¥æºåœºæ™¯
- AI å­¦ä¹ åŠŸèƒ½

---

## ğŸ¨ æ˜¾ç¤ºè§„åˆ™

### æŸ”æ€§æ˜¾ç¤ºï¼ˆé»˜è®¤ï¼‰

| æ—¶é•¿æ¥æº | ç½®ä¿¡åº¦ | æ˜¾ç¤ºç¤ºä¾‹ | è¯´æ˜ |
|---------|--------|---------|------|
| user_exact | 1.0 | `10:00 å¼€ä¼šï¼ˆ1å°æ—¶ï¼‰` | ç”¨æˆ·æ˜ç¡®æŒ‡å®š |
| ai_estimate | â‰¥0.7 | `10:00 å†™ä»£ç ï¼ˆçº¦1å°æ—¶ï¼‰` | é«˜ç½®ä¿¡åº¦ï¼Œä¸æ˜¾ç¤º"AIä¼°è®¡" |
| ai_estimate | <0.7 | `10:00 å¥èº«ï¼ˆçº¦1å°æ—¶ï¼ŒAIä¼°è®¡ï¼‰` | ä½ç½®ä¿¡åº¦ï¼Œæ˜¾ç¤º"AIä¼°è®¡" |
| default | 0.5 | `10:00 æ–°äº‹ä»¶ï¼ˆçº¦1å°æ—¶ï¼‰` | é»˜è®¤å€¼ï¼Œæ˜¾ç¤º"çº¦" |
| user_adjusted | 1.0 | `10:00 å­¦ä¹ ï¼ˆ2å°æ—¶ï¼‰` | ç”¨æˆ·ä¿®æ”¹è¿‡ï¼Œä¸æ˜¾ç¤º"çº¦" |

### åˆšæ€§æ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰

| åœºæ™¯ | æ˜¾ç¤ºç¤ºä¾‹ |
|------|---------|
| æœ‰ç»“æŸæ—¶é—´ | `10:00-11:00 å¼€ä¼š` |

---

## ğŸ”§ æ ¸å¿ƒå†³ç­–

| å†³ç­–ç‚¹ | æ–¹æ¡ˆ | ç†ç”± |
|--------|------|------|
| æ—¶é•¿æ¥æºè¿½è¸ª | 4ç§ç±»å‹ | user_exact, ai_estimate, default, user_adjusted |
| ç”¨æˆ·ä¿®æ”¹æ—¶é•¿ | user_adjusted | ä¿ç•™ AI åŸå§‹ä¼°è®¡ï¼Œä¾¿äºå­¦ä¹  |
| å†²çªæç¤º | å¼±æç¤º | "å¯èƒ½å†²çª"ï¼ˆAI ä¼°è®¡æ—¶é•¿æ—¶ï¼‰ |
| ç½®ä¿¡åº¦é˜ˆå€¼ | 0.7 | <70% æ˜¾ç¤º"AIä¼°è®¡"æ ‡æ³¨ |
| å®Œæˆåè®°å½• | è‡ªåŠ¨+å¯ä¿®æ­£ | æ ¹æ®å®Œæˆæ—¶é—´è‡ªåŠ¨è®¡ç®—ï¼Œå…è®¸æ‰‹åŠ¨ä¿®æ­£ |
| AI å­¦ä¹ ç»´åº¦ | ç»¼åˆç‰¹å¾ | æ ‡é¢˜+æè¿°+æ ‡ç­¾ç­‰å¤šç»´åº¦ |
| é»˜è®¤æ—¶é•¿ | æŒ‰éœ€ä½¿ç”¨ | æ²¡æœ‰å†å²æ•°æ®æ—¶æ‰ç”¨é»˜è®¤å€¼ |

---

## ğŸ“Š æ•°æ®æµç¤ºä¾‹

### åœºæ™¯1ï¼šç”¨æˆ·åˆ›å»ºäº‹ä»¶ï¼ˆæ— æ—¶é•¿ï¼‰

```
ç”¨æˆ·ï¼š"æ˜å¤©10ç‚¹å¼€ä¼š"
  â†“
AI ä¼°æ—¶ï¼š60åˆ†é’Ÿï¼ˆåŸºäºé»˜è®¤å€¼ï¼Œç½®ä¿¡åº¦0.5ï¼‰
  â†“
å­˜å‚¨ï¼š
{
  start_time: æ˜å¤©10:00,
  end_time: æ˜å¤©11:00,
  duration: 60,
  duration_source: "ai_estimate",
  duration_confidence: 0.5
}
  â†“
æ˜¾ç¤ºï¼š"10:00 å¼€ä¼šï¼ˆçº¦1å°æ—¶ï¼ŒAIä¼°è®¡ï¼‰"
```

### åœºæ™¯2ï¼šç”¨æˆ·æ˜ç¡®æŒ‡å®šæ—¶é•¿

```
ç”¨æˆ·ï¼š"æ˜å¤©10ç‚¹åˆ°11ç‚¹åŠå¼€ä¼š"
  â†“
è§£æï¼š
{
  start_time: æ˜å¤©10:00,
  end_time: æ˜å¤©11:30,
  duration: 90
}
  â†“
å­˜å‚¨ï¼š
{
  duration_source: "user_exact",
  duration_confidence: 1.0
}
  â†“
æ˜¾ç¤ºï¼š"10:00 å¼€ä¼šï¼ˆ1å°æ—¶30åˆ†é’Ÿï¼‰"
```

### åœºæ™¯3ï¼šç”¨æˆ·ä¿®æ”¹ AI ä¼°è®¡

```
AI ä¼°è®¡ï¼š10:00-11:00ï¼ˆ60åˆ†é’Ÿï¼‰
ç”¨æˆ·ï¼š"æ”¹æˆ2å°æ—¶"
  â†“
å­˜å‚¨ï¼š
{
  duration: 120,
  end_time: 12:00,
  duration_source: "user_adjusted",
  ai_original_estimate: 60,  # ä¿ç•™åŸå§‹ä¼°è®¡
  duration_confidence: 1.0
}
  â†“
æ˜¾ç¤ºï¼š"10:00 å¼€ä¼šï¼ˆ2å°æ—¶ï¼‰"
```

### åœºæ™¯4ï¼šäº‹ä»¶å®Œæˆå¹¶å­¦ä¹ 

```
äº‹ä»¶å®Œæˆï¼š11:20 ç»“æŸ
  â†“
è®¡ç®—å®é™…æ—¶é•¿ï¼š80åˆ†é’Ÿ
  â†“
AI å­¦ä¹ ï¼š
- ä¼°è®¡ï¼š60åˆ†é’Ÿ
- å®é™…ï¼š80åˆ†é’Ÿ
- è¯¯å·®ï¼š20åˆ†é’Ÿï¼ˆ33%ï¼‰
  â†“
æ›´æ–°æ¨¡å‹ï¼šä¸‹æ¬¡"å¼€ä¼š"ä¼°è®¡ä¸º70åˆ†é’Ÿ
```

---

## âœ… æµ‹è¯•ç»“æœ

æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼š
- âœ… Duration Estimator Agent
- âœ… Time Formatter
- âœ… Duration Source Scenarios
- âœ… AI Learning

---

## ğŸ¯ ç”¨æˆ·ä½“éªŒæ”¹è¿›

### æ”¹è¿›å‰ï¼ˆåˆšæ€§æ—¶é—´ï¼‰
```
10:00-11:00 å¼€ä¼š
- æ„Ÿè§‰æ­»æ¿ï¼Œå‹åŠ›å¤§
- å»¶æ—¶ä¼šäº§ç”Ÿç„¦è™‘
- ä¸ç¬¦åˆçœŸå®ç”Ÿæ´»
```

### æ”¹è¿›åï¼ˆæŸ”æ€§æ—¶é—´ï¼‰
```
10:00 å¼€ä¼šï¼ˆçº¦1å°æ—¶ï¼‰
- æ›´çµæ´»ï¼Œå‡å°‘ç„¦è™‘
- æ›´ç¬¦åˆçœŸå®ç”Ÿæ´»
- AI æ ‡æ³¨æ¸…æ¥šä¿¡æ¯æ¥æº
```

---

## ğŸ“ ä¸‹ä¸€æ­¥è®¡åˆ’

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰
- [ ] æ·»åŠ å†å²æ•°æ®æŒä¹…åŒ–ï¼ˆduration_history è¡¨ï¼‰
- [ ] å®Œå–„å†²çªæ£€æµ‹çš„æŸ”æ€§æç¤º
- [ ] ä¼˜åŒ– AI ä¼°æ—¶çš„å‡†ç¡®åº¦

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰
- [ ] å®ç°æ—¶é•¿è°ƒæ•´å·¥å…·ï¼ˆallow user to adjust durationï¼‰
- [ ] æ·»åŠ æ—¶é•¿ç»Ÿè®¡å’Œå¯è§†åŒ–
- [ ] æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰é»˜è®¤æ—¶é•¿

### é•¿æœŸï¼ˆ2-3ä¸ªæœˆï¼‰
- [ ] åŸºäºå¤§é‡æ•°æ®çš„ AI å­¦ä¹ 
- [ ] è·¨ç”¨æˆ·çš„çŸ¥è¯†å…±äº«ï¼ˆåŒ¿åèšåˆï¼‰
- [ ] æ—¶é•¿é¢„æµ‹çš„è¶‹åŠ¿åˆ†æ

---

## ğŸ‰ æ€»ç»“

æˆåŠŸå®ç°äº†åŒå±‚æ—¶é—´æ¶æ„ï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š

1. **ç”¨æˆ·å‹å¥½**ï¼šæŸ”æ€§æ˜¾ç¤ºå‡å°‘ç„¦è™‘
2. **å¼€å‘å¯æ§**ï¼šåˆšæ€§æ•°æ®æ”¯æŒç®—æ³•
3. **æ™ºèƒ½è¿›åŒ–**ï¼šAI æŒç»­å­¦ä¹ ä¼˜åŒ–
4. **å‘åå…¼å®¹**ï¼šä¿ç•™åˆšæ€§æ˜¾ç¤ºé€‰é¡¹

è¿™æ˜¯ä¸€ä¸ª**åŠ¡å®çš„å·¥ç¨‹åŒ–æ–¹æ¡ˆ**ï¼Œå¹³è¡¡äº†ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿå¤æ‚åº¦ã€‚
