# UniLife Backend

AI-powered life scheduling assistant - Backend API

## é¡¹ç›®ç®€ä»‹

UniLife æ˜¯ä¸€ä¸ªå…·å¤‡è‡ªä¸»å†³ç­–èƒ½åŠ›çš„ AI ç”Ÿæ´»ç®¡å®¶ï¼Œå®ƒç†è§£ç”¨æˆ·çš„ç²¾åŠ›çŠ¶æ€ã€ä»»åŠ¡çš„æ€¥è¿«ç¨‹åº¦ä»¥åŠç¤¾äº¤å…³ç³»ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯ï¼š**æ¶ˆé™¤"è®¤çŸ¥æ‘©æ“¦"ï¼Œè®©ç”¨æˆ·ä»ç¹ççš„æ—¥ç¨‹å®‰æ’ä¸­è§£æ”¾å‡ºæ¥ï¼Œä¸“æ³¨äºç”Ÿæ´»æœ¬èº«ã€‚**

## æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI
- **æ•°æ®åº“**: SQLite (å¼€å‘) / PostgreSQL (ç”Ÿäº§)
- **ORM**: SQLAlchemy
- **LLM**: DeepSeek API
- **éƒ¨ç½²**: Railway / Render / å›½å†…äº‘æœåŠ¡

## é¡¹ç›®ç»“æ„

```
unilife-backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py            # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ event.py         # äº‹ä»¶ã€ç²¾åŠ›ç­‰çº§ã€ç±»åˆ«æšä¸¾ã€å¢å¼ºå­—æ®µ
â”‚   â”‚   â”œâ”€â”€ preference.py    # ç”¨æˆ·åå¥½æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user_profile.py  # ç”¨æˆ·ç”»åƒæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ database_snapshot.py  # å¿«ç…§æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routine.py       # ä¹ æƒ¯/é•¿æœŸæ—¥ç¨‹æ¨¡å‹
â”‚   â”‚   â””â”€â”€ conversation.py  # å¯¹è¯è®°å½•æ¨¡å‹
â”‚   â”œâ”€â”€ agents/              # AI Agents (4å±‚ç¼–æ’æ¶æ„)
â”‚   â”‚   â”œâ”€â”€ orchestrator.py  # ä¸»ç¼–æ’å™¨
â”‚   â”‚   â”œâ”€â”€ router.py        # è·¯ç”±Agent (æ„å›¾åˆ†ç±»)
â”‚   â”‚   â”œâ”€â”€ executor.py      # æ‰§è¡ŒAgent (å·¥å…·è°ƒç”¨)
â”‚   â”‚   â”œâ”€â”€ persona.py       # é™ªä¼´Agent (æ‹ŸäººåŒ–å›å¤)
â”‚   â”‚   â”œâ”€â”€ observer.py      # è§‚å¯ŸAgent (ç”»åƒå­¦ä¹ )
â”‚   â”‚   â”œâ”€â”€ base.py          # åŸºç¡€æ¥å£å’Œæšä¸¾
â”‚   â”‚   â”œâ”€â”€ duration_estimator.py   # æ—¶é•¿ä¼°ç®—ä¸“å®¶
â”‚   â”‚   â”œâ”€â”€ energy_evaluator.py     # ç²¾åŠ›æ¶ˆè€—è¯„ä¼°ä¸“å®¶
â”‚   â”‚   â”œâ”€â”€ smart_scheduler.py      # æ™ºèƒ½æ—¥ç¨‹è°ƒåº¦åŠ©æ‰‹
â”‚   â”‚   â””â”€â”€ tools.py         # å·¥å…·æ³¨å†Œè¡¨ (26ä¸ªå·¥å…·)
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ db.py            # æ•°æ®åº“æœåŠ¡ (SQLAlchemy)
â”‚   â”‚   â”œâ”€â”€ llm.py           # LLM æœåŠ¡ (DeepSeek + é‡è¯•æœºåˆ¶)
â”‚   â”‚   â”œâ”€â”€ snapshot.py      # å¿«ç…§æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ profile_service.py   # ç”¨æˆ·ç”»åƒæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ routine_service.py   # ä¹ æƒ¯ç®¡ç†æœåŠ¡
â”‚   â”‚   â””â”€â”€ conversation_service.py  # å¯¹è¯è®°å½•æœåŠ¡
â”‚   â”œâ”€â”€ api/                 # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ chat.py          # å¯¹è¯å¼æ¥å£
â”‚   â”‚   â”œâ”€â”€ events.py        # äº‹ä»¶ CRUD
â”‚   â”‚   â”œâ”€â”€ users.py         # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ snapshots.py     # å¿«ç…§ç®¡ç†
â”‚   â”‚   â””â”€â”€ stats.py         # ç»Ÿè®¡æ•°æ®
â”‚   â”œâ”€â”€ schemas/             # Pydantic è¯·æ±‚/å“åº”æ¨¡å‹
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ prompts/                 # AI æç¤ºè¯æ¨¡æ¿
â”‚   â””â”€â”€ agents/              # å„Agentçš„æç¤ºè¯æ–‡ä»¶
â”‚       â”œâ”€â”€ router.txt       # Router æ„å›¾åˆ†ç±»
â”‚       â”œâ”€â”€ executor.txt     # Executor æ‰§è¡Œé€»è¾‘
â”‚       â”œâ”€â”€ persona.txt      # Persona æ‹ŸäººåŒ–å›å¤
â”‚       â””â”€â”€ observer.txt     # Observer è¡Œä¸ºåˆ†æ
â”œâ”€â”€ tests/                   # æµ‹è¯•
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”œâ”€â”€ client.py                # ç»ˆç«¯å®¢æˆ·ç«¯
â”œâ”€â”€ init_db.py              # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ migrate_db.py           # æ•°æ®åº“è¿ç§»è„šæœ¬
â”œâ”€â”€ migrate_routine.py      # Routine åŠŸèƒ½è¿ç§»è„šæœ¬
â”œâ”€â”€ migrate_enhanced_features.py  # å¢å¼ºåŠŸèƒ½è¿ç§»è„šæœ¬
â”œâ”€â”€ migrate_conversations.py  # å¯¹è¯è®°å½•è¿ç§»è„šæœ¬
â”œâ”€â”€ test_deepseek_connection.py  # è¿æ¥æµ‹è¯•å·¥å…·
â”œâ”€â”€ test_enhanced_features.py  # å¢å¼ºåŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_routine.py          # Routine åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_conversation.py     # å¯¹è¯è®°å½•æµ‹è¯•
â”œâ”€â”€ requirements.txt         # ä¾èµ–åŒ…
â””â”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
```

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶å¡«å†™é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å†™ä»¥ä¸‹å¿…éœ€é…ç½®ï¼š
- `DEEPSEEK_API_KEY`: DeepSeek API key
- `JWT_SECRET_KEY`: JWT å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»æ›´æ”¹ï¼‰

æ•°æ®åº“é»˜è®¤ä½¿ç”¨ SQLiteï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚å¦‚éœ€ä½¿ç”¨ PostgreSQLï¼Œè¯·è®¾ç½®ï¼š
- `DB_TYPE=postgresql`
- `POSTGRESQL_URL=postgresql+asyncpg://user:password@localhost:5432/unilife`

### 3. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰

è¿è¡Œåˆå§‹åŒ–è„šæœ¬åˆ›å»ºæ•°æ®åº“è¡¨å’Œç¤ºä¾‹æ•°æ®ï¼š

```bash
python init_db.py
```

è¿™ä¼šåˆ›å»ºï¼š
- æ•°æ®åº“è¡¨ï¼ˆusers, events, snapshots, user_memory, user_preferencesï¼‰
- ä¸€ä¸ªç¤ºä¾‹ç”¨æˆ·è´¦å·

### 4. æ•°æ®åº“è¿ç§»ï¼ˆé‡è¦ï¼ï¼‰

å¦‚æœæ‚¨ä»æ—§ç‰ˆæœ¬å‡çº§ï¼Œéœ€è¦æŒ‰é¡ºåºè¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ï¼š

#### 4.1 åŸºç¡€è¿ç§»
```bash
python migrate_db.py
```
- è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“ï¼ˆ`unilife.db.backup`ï¼‰
- æ·»åŠ  6 ä¸ªæ–°å­—æ®µæ”¯æŒ Routine/Habit ç®¡ç†

#### 4.2 Routine åŠŸèƒ½è¿ç§»
```bash
python migrate_routine.py
```
- åˆ›å»º routines è¡¨
- æ·»åŠ ä¹ æƒ¯ç®¡ç†ç›¸å…³åŠŸèƒ½

#### 4.3 å¢å¼ºåŠŸèƒ½è¿ç§»
```bash
python migrate_enhanced_features.py
```
- æ·»åŠ ç²¾åŠ›è¯„ä¼°å­—æ®µï¼ˆenergy_consumptionï¼‰
- æ·»åŠ  AI æè¿°å­—æ®µï¼ˆai_descriptionï¼‰
- æ·»åŠ ç”»åƒç‚¹å­—æ®µï¼ˆextracted_pointsï¼‰
- åˆ›å»ºç”¨æˆ·ç”»åƒè¡¨ï¼ˆuser_profilesï¼‰
- åˆ›å»ºæ•°æ®åº“å¿«ç…§è¡¨ï¼ˆdatabase_snapshotsï¼‰

#### 4.4 å¯¹è¯è®°å½•è¿ç§»
```bash
python migrate_conversations.py
```
- åˆ›å»ºå¯¹è¯è®°å½•è¡¨ï¼ˆconversationsï¼‰
- æ”¯æŒå¯¹è¯å†å²æŒä¹…åŒ–

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
python -m app.main
```

æˆ–ä½¿ç”¨ uvicornï¼š

```bash
uvicorn app.main:app --reload
```

API æ–‡æ¡£è®¿é—®ï¼šhttp://localhost:8000/docs

### 6. ä½¿ç”¨ç»ˆç«¯å®¢æˆ·ç«¯ï¼ˆå¯é€‰ï¼‰

æä¾›äº†äº¤äº’å¼ç»ˆç«¯å®¢æˆ·ç«¯ç”¨äºæµ‹è¯•ï¼š

```bash
python client.py
```

åŠŸèƒ½ï¼š
- ç”¨æˆ·ç™»å½•ï¼ˆID æŒä¹…åŒ–å­˜å‚¨ï¼‰
- äº¤äº’å¼å¯¹è¯
- è‡ªåŠ¨å¤„ç†é€‰é¡¹å’Œæ¦‚ç‡æ˜¾ç¤º
- å½©è‰²è¾“å‡º

## API ç«¯ç‚¹

### æ ¸å¿ƒæ¥å£

- `POST /api/v1/chat` - å¯¹è¯å¼æ¥å£ï¼ˆä¸»è¦äº¤äº’å…¥å£ï¼‰
- `GET /api/v1/chat/history` - è·å–å¯¹è¯å†å²
- `DELETE /api/v1/chat/history` - æ¸…é™¤å¯¹è¯å†å²
- `POST /api/v1/chat/feedback` - æä¾›åé¦ˆ

### äº‹ä»¶ç®¡ç†

- `GET /api/v1/events` - è·å–äº‹ä»¶åˆ—è¡¨
- `POST /api/v1/events` - åˆ›å»ºäº‹ä»¶
- `GET /api/v1/events/{id}` - è·å–å•ä¸ªäº‹ä»¶
- `PUT /api/v1/events/{id}` - æ›´æ–°äº‹ä»¶
- `DELETE /api/v1/events/{id}` - åˆ é™¤äº‹ä»¶

### ç”¨æˆ·ç®¡ç†

- `POST /api/v1/users/register` - æ³¨å†Œ
- `POST /api/v1/users/login` - ç™»å½•
- `GET /api/v1/users/me` - è·å–å½“å‰ç”¨æˆ·
- `PUT /api/v1/users/me` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `PUT /api/v1/users/me/energy` - æ›´æ–°ç²¾åŠ›é…ç½®

### å¿«ç…§ç³»ç»Ÿ

- `GET /api/v1/snapshots` - è·å–å¿«ç…§åˆ—è¡¨
- `POST /api/v1/snapshots/{id}/revert` - å›é€€åˆ°å¿«ç…§

### ç»Ÿè®¡æ•°æ®

- `GET /api/v1/stats/energy` - ç²¾åŠ›ç»Ÿè®¡
- `GET /api/v1/stats/productivity` - æ•ˆç‡ç»Ÿè®¡
- `GET /api/v1/stats/time-saved` - èŠ‚çœæ—¶é—´ç»Ÿè®¡

## å¯¹è¯ç¤ºä¾‹

### åˆ›å»ºäº‹ä»¶

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "å¸®æˆ‘å®‰æ’æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼šï¼Œå¤§æ¦‚1å°æ—¶"
}
```

### æŸ¥è¯¢æ—¥ç¨‹

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "æˆ‘æ˜å¤©æœ‰ä»€ä¹ˆå®‰æ’ï¼Ÿ"
}
```

### æ’¤é”€æ“ä½œ

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "æ’¤é”€åˆšæ‰çš„æ“ä½œ"
}
```

### æŸ¥çœ‹ç²¾åŠ›çŠ¶æ€

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "æˆ‘ç°åœ¨çŠ¶æ€æ€ä¹ˆæ ·ï¼Ÿ"
}
```

### åˆ›å»ºé•¿æœŸæ—¥ç¨‹/ä¹ æƒ¯

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "æˆ‘æƒ³æ¯å‘¨ä¸€ä¸‰å››äº”å¥èº«"
}
```

AI ä¼šè¯¢é—®ï¼š
- æ—¶é—´æ˜¯å¦çµæ´»ï¼ˆæ¯å¤©å†å®š / å›ºå®šæ—¶é—´ï¼‰
- åå¥½æ—¶é—´æ®µ
- è¡¥è¯¾ç­–ç•¥ï¼ˆå¦‚æœæŸå¤©æ²¡æ—¶é—´ï¼‰

### æŸ¥çœ‹ä»Šå¤©çš„é•¿æœŸæ—¥ç¨‹

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "ä»Šå¤©æœ‰ä»€ä¹ˆä¹ æƒ¯å¾…å®Œæˆï¼Ÿ"
}
```

### å®Œæˆä¹ æƒ¯å¹¶æŸ¥çœ‹ç»Ÿè®¡

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "æˆ‘å®Œæˆäº†ä»Šå¤©çš„å¥èº«ï¼ŒåšæŒå¾—æ€ä¹ˆæ ·ï¼Ÿ"
}
```

### ç²¾åŠ›è¯„ä¼°

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "å¸®æˆ‘è¯„ä¼°ä¸€ä¸‹è¿™ä¸ªæ´»åŠ¨ä¼šæ¶ˆè€—å¤šå°‘ç²¾åŠ›"
}
```

ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†ææ´»åŠ¨çš„ä½“åŠ›æ¶ˆè€—å’Œç²¾ç¥æ¶ˆè€—ï¼Œå¹¶æä¾›ï¼š
- ç­‰çº§ï¼ˆLow/Medium/Highï¼‰
- åˆ†æ•°ï¼ˆ0-10ï¼‰
- è¯¦ç»†æè¿°
- å½±å“å› ç´ 

### æ—¥ç¨‹åˆ†æ

```json
POST /api/v1/chat
{
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "å¸®æˆ‘çœ‹çœ‹æ˜å¤©çš„å®‰æ’åˆç†å—ï¼Ÿ"
}
```

æ™ºèƒ½è°ƒåº¦å™¨ä¼šæ£€æŸ¥ï¼š
- è¿ç»­é«˜å¼ºåº¦ä½“åŠ›/ç²¾ç¥æ´»åŠ¨
- å•ä¸€ç»´åº¦è¿‡åº¦é›†ä¸­
- ç¼ºä¹ä¼‘æ¯æˆ–è°ƒèŠ‚
- æä¾›ä¼˜åŒ–å»ºè®®

### ç”¨æˆ·ç”»åƒï¼ˆè‡ªåŠ¨å­¦ä¹ ï¼‰

ç³»ç»Ÿä¼šè‡ªåŠ¨ä»æ‚¨çš„äº‹ä»¶ä¸­å­¦ä¹ ï¼š
- å…³ç³»çŠ¶æ€ï¼ˆå•èº«/çº¦ä¼šä¸­/å·²å©šï¼‰
- èŒä¸šèº«ä»½
- æ´»åŠ¨åå¥½
- ç”Ÿæ´»ä¹ æƒ¯

**ç‰¹ç‚¹**ï¼š
- ä¸ä¸»åŠ¨è¯¢é—®ï¼Œé€šè¿‡è§‚å¯Ÿå­¦ä¹ 
- é€æ¸æå‡å‡†ç¡®æ€§
- æ”¯æŒä¸ªæ€§åŒ–å»ºè®®

## AI Agent æ¶æ„

### 4å±‚å¤šæ™ºèƒ½ä½“ç¼–æ’ç³»ç»Ÿ

é‡‡ç”¨ **AgentOrchestrator** åè°ƒå››ä¸ªä¸“ä¸šåŒ– Agentï¼Œå®ç°äººæ ¼ä¸é€»è¾‘åˆ†ç¦»ã€åŠ¨æ€ä¸Šä¸‹æ–‡æ³¨å…¥å’Œè‡ªæˆ‘è¿›åŒ–é—­ç¯ã€‚

```
ç”¨æˆ·æ¶ˆæ¯ â†’ Orchestrator
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“           â†“           â†“
    Router     Executor     Persona
   (æ„å›¾)     (å·¥å…·)       (å…±æƒ…)
        â”‚           â”‚           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
            Response (åŒæ­¥)
                    â†“
            Observer (å¼‚æ­¥)
                    â†“
        æ›´æ–°ç”¨æˆ·ç”»åƒ
```

#### 1. RouterAgent - è·¯ç”±è°ƒåº¦å®˜
- **åŠŸèƒ½**ï¼šæ„å›¾åˆ†ç±»å’Œè·¯ç”±å†³ç­–
- **è¾“å‡º**ï¼š`EXECUTOR` / `PERSONA` / `BOTH`
- **ç‰¹ç‚¹**ï¼šæ™ºèƒ½ä¸Šä¸‹æ–‡è¿‡æ»¤ï¼Œå‡å°‘ 40-60% token ä½¿ç”¨

#### 2. ExecutorAgent - æ‰§è¡Œå®˜
- **åŠŸèƒ½**ï¼šç†æ€§å·¥å…·æ‰§è¡Œï¼Œæ— æƒ…æ„Ÿ
- **æ³¨å…¥**ï¼šç”¨æˆ·å†³ç­–åå¥½ï¼ˆ`UserDecisionProfile`ï¼‰
- **èƒ½åŠ›**ï¼š26 ä¸ªå·¥å…·ï¼Œæœ€å¤š 30 æ¬¡è¿­ä»£çš„å¤šæ­¥æ¨ç†

**å·¥å…·åˆ†ç±»ï¼ˆ26ä¸ªï¼‰ï¼š**

| åˆ†ç±» | å·¥å…·æ•° | ç¤ºä¾‹ |
|------|--------|------|
| äº‹ä»¶ç®¡ç† | 6 | create_event, query_events, delete_event, update_event, complete_event, check_time_conflicts |
| Routineç®¡ç† | 5 | create_routine_template, get_events_with_routines, handle_routine_instance, get_active_routines, get_routine_stats |
| æ—¶é—´è§£æ | 1 | parse_time (æ”¯æŒ"æ˜å¤©ä¸‹åˆ3ç‚¹"ã€"ä¸‹å‘¨ä¸‰"ç­‰) |
| ç²¾åŠ›ç®¡ç† | 4 | evaluate_energy_consumption, analyze_schedule, get_user_energy, get_schedule_overview |
| ç”¨æˆ·åå¥½ | 3 | analyze_preferences, record_preference, provide_suggestions |
| å¿«ç…§ç³»ç»Ÿ | 2 | create_snapshot, revert_snapshot |

#### 3. PersonaAgent - é™ªä¼´è€…
- **åŠŸèƒ½**ï¼šç”Ÿæˆæ¸©æš–ã€ç®€æ´ã€æ‹ŸäººåŒ–çš„å›å¤
- **æ³¨å…¥**ï¼šç”¨æˆ·äººæ ¼ç”»åƒï¼ˆ`UserProfile`ï¼‰
- **é£æ ¼**ï¼š1-3 å¥è¯ï¼Œæœ‰åŒç†å¿ƒä½†ä¸è‚‰éº»

#### 4. ObserverAgent - è§‚å¯Ÿè€…
- **åŠŸèƒ½**ï¼šå¼‚æ­¥åˆ†æå¯¹è¯ï¼Œå­¦ä¹ ç”¨æˆ·ç”»åƒ
- **è§¦å‘**ï¼šå¯¹è¯ç»“æŸ / 8-15 æ¡æ¶ˆæ¯ / å®šæ—¶åˆ†æ
- **æ›´æ–°**ï¼š`UserProfile`ï¼ˆäººæ ¼ï¼‰+ `UserDecisionProfile`ï¼ˆå†³ç­–åå¥½ï¼‰

### ä¸“ç”¨ä¸“å®¶ Agent

#### Energy Evaluator Agent
- **åŠŸèƒ½**ï¼šè¯„ä¼°äº‹ä»¶åœ¨ä½“åŠ›ï¼ˆPhysicalï¼‰å’Œç²¾ç¥ï¼ˆMentalï¼‰ä¸¤ä¸ªç»´åº¦çš„æ¶ˆè€—ç¨‹åº¦
- **è¯„ä¼°æ ‡å‡†**ï¼šLow (0-3åˆ†) / Medium (4-6åˆ†) / High (7-10åˆ†)
- **è¾“å‡ºç»“æ„**ï¼šlevel + score + description + factors

#### Smart Scheduler Agent
- **åŠŸèƒ½**ï¼šæ£€æµ‹ä¸åˆç†çš„äº‹ä»¶ç»„åˆï¼Œæä¾›ç²¾åŠ›ä¼˜åŒ–å»ºè®®
- **æ£€æµ‹é—®é¢˜**ï¼šè¿ç»­é«˜å¼ºåº¦æ´»åŠ¨ã€å•ä¸€ç»´åº¦è¿‡åº¦é›†ä¸­ã€ç¼ºä¹ä¼‘æ¯

#### Duration Estimator Agent
- **åŠŸèƒ½**ï¼šåŸºäºå†å²æ•°æ®ä¼°ç®—äº‹ä»¶æ—¶é•¿
- **ç‰¹ç‚¹**ï¼šç½®ä¿¡åº¦è¿½è¸ªï¼Œæ”¯æŒç”¨æˆ·çº æ­£å’Œå­¦ä¹ 

## æ•°æ®åº“

### SQLite (é»˜è®¤ - å¼€å‘ç¯å¢ƒ)
- æœ¬åœ°æ–‡ä»¶æ•°æ®åº“ï¼Œæ— éœ€å¤–éƒ¨æœåŠ¡
- æ•°æ®æ–‡ä»¶: `unilife.db`
- é€‚åˆå¿«é€Ÿå¼€å‘å’Œæµ‹è¯•

### PostgreSQL (ç”Ÿäº§ç¯å¢ƒ)
- æ”¯æŒé«˜å¹¶å‘å’Œå¤§æ•°æ®é‡
- å¯é…ç½®å›½å†…äº‘æœåŠ¡ï¼ˆè…¾è®¯äº‘ã€é˜¿é‡Œäº‘ç­‰ï¼‰
- è¿ç§»æ–¹å¼ï¼šä¿®æ”¹ `.env` ä¸­çš„ `DB_TYPE` å’Œ `POSTGRESQL_URL`

### æ•°æ®è¡¨

- **users** - ç”¨æˆ·ä¿¡æ¯åŠç²¾åŠ›é…ç½®
- **events** - æ—¥ç¨‹äº‹ä»¶
  - åŸºç¡€å­—æ®µï¼ˆtitle, start_time, duration ç­‰ï¼‰
  - Routine ç›¸å…³å­—æ®µï¼ˆ6ä¸ªï¼‰
  - å¢å¼ºåŠŸèƒ½å­—æ®µï¼ˆ3ä¸ªï¼‰
- **routines** - é•¿æœŸæ—¥ç¨‹/ä¹ æƒ¯
- **snapshots** - å¿«ç…§è®°å½•
- **conversations** - å¯¹è¯è®°å½•
- **user_memory** - ç”¨æˆ·è®°å¿†ä¸å­¦ä¹ æ•°æ®
- **user_preferences** - ç”¨æˆ·åå¥½å­¦ä¹ è®°å½•
  - scenario_type - åœºæ™¯ç±»å‹ï¼ˆå¦‚ time_conflict, event_cancellationï¼‰
  - decision - ç”¨æˆ·å†³ç­–
  - context - ä¸Šä¸‹æ–‡ä¿¡æ¯
  - weight - æƒé‡ï¼ˆé»˜è®¤ 1.0ï¼‰
- **user_profiles** - ç”¨æˆ·ç”»åƒ
- **database_snapshots** - æ•°æ®åº“å¿«ç…§ï¼ˆå¢é‡ï¼‰

**Events è¡¨ Routine ç›¸å…³å­—æ®µï¼š**
- repeat_rule - é‡å¤è§„åˆ™ï¼ˆdaily/weekly/customï¼‰
- is_flexible - æ—¶é—´æ˜¯å¦çµæ´»
- preferred_time_slots - åå¥½æ—¶é—´æ®µ
- makeup_strategy - è¡¥è¯¾ç­–ç•¥
- parent_routine_id - çˆ¶ routine ID
- routine_completed_dates - å®Œæˆæ—¥æœŸåˆ—è¡¨

**Events è¡¨å¢å¼ºåŠŸèƒ½å­—æ®µï¼š**
- energy_consumption - ç²¾åŠ›æ¶ˆè€—è¯„ä¼°ï¼ˆJSONï¼‰
  - physical: ä½“åŠ›æ¶ˆè€—ï¼ˆlevel, score, description, factorsï¼‰
  - mental: ç²¾ç¥æ¶ˆè€—ï¼ˆlevel, score, description, factorsï¼‰
- ai_description - AI ç”Ÿæˆçš„æ´»åŠ¨æè¿°
- extracted_points - æå–çš„ç”¨æˆ·ç”»åƒç‚¹ï¼ˆJSON æ•°ç»„ï¼‰

## å¼€å‘è®¡åˆ’

### Phase 1: æ ¸å¿ƒåç«¯ (P0) - âœ… å®Œæˆ
- [x] é¡¹ç›®åˆå§‹åŒ–
- [x] æ•°æ®æ¨¡å‹å®šä¹‰
- [x] Jarvis Agent å®ç°ï¼ˆLLM + Tools æ¶æ„ï¼‰
- [x] 18 ä¸ªå·¥å…·å®ç°
- [x] å¿«ç…§ç³»ç»Ÿ
- [x] ç²¾åŠ›ç³»ç»Ÿ
- [x] èŠå¤© API é›†æˆ
- [x] SQLite æ•°æ®åº“æ”¯æŒ
- [x] æ•°æ®åº“è¿ç§»è„šæœ¬

### Phase 2: æ™ºèƒ½å¢å¼º (P1) - âœ… æ ¸å¿ƒå®Œæˆ
- [x] ç”¨æˆ·åå¥½å­¦ä¹ ç³»ç»Ÿ
- [x] äº¤äº’å¼å»ºè®®ï¼ˆå¸¦æ¦‚ç‡æ˜¾ç¤ºï¼‰
- [x] åŠ¨æ€æƒé‡å†³ç­–
- [x] ä¸Šä¸‹æ–‡æ„ŸçŸ¥åˆ†æ
- [x] Routine/Habit ç®¡ç†ç³»ç»Ÿ
  - [x] çµæ´»æ—¶é—´å®‰æ’
  - [x] è¡¥è¯¾æœºåˆ¶
  - [x] å®Œæˆè¿½è¸ªç»Ÿè®¡
- [x] æ™ºèƒ½æ—¶é—´è§£æå¢å¼º
  - [x] ç²¾ç¡®æ—¶é—´è§£æï¼ˆæ˜å¤©ä¸‹åˆ3ç‚¹ã€15:30ï¼‰
  - [x] ç›¸å¯¹æ—¥æœŸï¼ˆä»Šå¤©ã€æ˜å¤©ã€åå¤©ã€å¤§åå¤©ï¼‰
  - [x] æ˜ŸæœŸå‡ ï¼ˆä¸‹å‘¨ä¸‰ã€æœ¬å‘¨äº”ï¼‰
  - [x] æ¨¡ç³Šæ—¶é—´ï¼ˆå‚æ™šã€ä¸Šåˆæ™šäº›æ—¶å€™ï¼‰
  - [x] æ—¶é—´èŒƒå›´ï¼ˆæœ¬å‘¨ä¸‰åˆ°å‘¨äº”ï¼‰
- [x] ç²¾åŠ›è¯„ä¼°ç³»ç»Ÿ â­ NEW
  - [x] åŒç»´åº¦è¯„ä¼°ï¼ˆä½“åŠ› + ç²¾ç¥ï¼‰
  - [x] Energy Evaluator Agent
  - [x] Smart Scheduler Agent
  - [x] æ—¥ç¨‹åˆç†æ€§æ£€æµ‹
- [x] ç”¨æˆ·ç”»åƒç³»ç»Ÿ â­ NEW
  - [x] Context Extractor Agent
  - [x] å››ç»´åº¦ç”»åƒï¼ˆå…³ç³»ã€èº«ä»½ã€å–œå¥½ã€ä¹ æƒ¯ï¼‰
  - [x] è§‚å¯Ÿå¼å­¦ä¹ ï¼ˆä¸ä¸»åŠ¨è¯¢é—®ï¼‰
  - [x] ç”»åƒæŒä¹…åŒ–
- [x] å¯¹è¯è®°å½•æŒä¹…åŒ– â­ NEW
  - [x] å¯¹è¯å†å²å­˜å‚¨
  - [x] ä¸Šä¸‹æ–‡ä¼ é€’
- [x] å¿«ç…§å›æ»šç³»ç»Ÿ â­ NEW
  - [x] å¿«ç…§æ•°æ®æ¨¡å‹
  - [x] åˆ›å»º/æ’¤é”€/å›æ»šåŠŸèƒ½
  - [x] æ”¯æŒä¸‰ç§æ“ä½œç±»å‹ï¼ˆcreate/update/deleteï¼‰

### Phase 2.5: å¢å¼ºåŠŸèƒ½å®Œå–„ (P1.5) - ğŸš§ è¿›è¡Œä¸­
- [ ] æ™ºèƒ½æé†’æ¨é€ç³»ç»Ÿ
  - [ ] æ—¥ç¨‹å¼€å§‹å‰æé†’
  - [ ] ä¹ æƒ¯æ‰“å¡æé†’
  - [ ] çµæ´»æ—¶é—´ç¡®è®¤æé†’
- [ ] ç”¨æˆ·ç”»åƒçº é”™æœºåˆ¶
  - [ ] çº é”™ä¿¡å·è¯†åˆ«
  - [ ] ç½®ä¿¡åº¦åŠ¨æ€è°ƒæ•´
  - [ ] çº é”™è®°å½•å­˜å‚¨
- [ ] å¤šå¹³å°å‰ç«¯é€‚é…
  - [ ] å¾®ä¿¡æœºå™¨äººæ¥å…¥
  - [ ] iOS åº”ç”¨é€‚é…

### Phase 3: ç”Ÿæ´»æ§åˆ¶å° (P2)
- [ ] ç»Ÿè®¡ API
- [ ] ç²¾åŠ›çƒ­åŠ›å›¾æ•°æ®
- [ ] æ•ˆç‡æŠ¥å‘Š
- [ ] ä¹ æƒ¯æ‰“å¡æ—¥å†è§†å›¾

### Phase 4: A2A ç¤¾äº¤ (P3) - å¾…å®š
- [ ] Agent ä»£ç†è°ˆåˆ¤
- [ ] Agent-Aware é€šè®¯å½•
- [ ] ç¤¾äº¤é˜²ç«å¢™

## æµ‹è¯•

è¿è¡Œæµ‹è¯•ï¼š

```bash
pytest
```

## æ–‡æ¡£

è¯¦ç»†çš„äº§å“éœ€æ±‚æ–‡æ¡£è¯·æŸ¥çœ‹ `docs/` ç›®å½•ï¼š

- `UniLife_PRD_v1.md` - äº§å“éœ€æ±‚æ–‡æ¡£
- `UniLife_Product_Functional_Spec.md` - åŠŸèƒ½è¯¦è¿°æ–‡æ¡£

## License

MIT
